# Trampoline Prefactor

Note: opening a new doc for the open PR, lots of notes are in
ldk-trampoline.md.

## Review Round 1 (Matt)

Easy fixes:
- [x] Need to write values in `PaymentForwarded` w/ one HTLC
  I think we should just always write the legacy field then. Because
  we could have a one-in-one out trampoline payment which would look
  like a regular payment, but the event will have the wrong fees.
  We'll fail to downgrade elsewhere if we have trampoline in flight,
  so I think it's fine to keep the complication.

- [x] Can we use `init_and_real_tlv_fields` for `HTLCSource`? Yes
  
- [x] What about the blinded tail we're paying to? For blinded errors?
- [bug] Looks like the `BlindedTail` is missing in follow up PR!
  `fail_htlc_backwards_internal` just sets this to `None`?
  which is used in `trampoline_htlc_failed` (incorrectly, since it'll
  always be `None`!)

Response: Indeed, should be `Path`, was missing in the dependent PR.

- [x] Always write channel_id for `HTLCHandlingFailed`

- [ ] On startup we need to do reconcilliation of forwards:

Yes, we need to do this.
Q: maybe do this in followup PR? Depending on what state it needs.
